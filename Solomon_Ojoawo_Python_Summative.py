#AIIP Python Summative
#Author - Solomon Ojoawo
#Problem 1 and 2 of the Summative Assignment
# This program generates thirty(30) time stamped Randomly generated sensor data every 5 seconds and saves output to file
#The data generated are for 32 clusters of 16 sensors each


import time  # for delaying in second
import random  # to generate float values as readings between 0 and 1
import sys #to use the standard out function
import logging #to use the logging functionality

#Problem 2 - save output to a text file and avoid overwrite
class Logger(object): #to automatically create Log Record of output
    def __init__(self): # declare variable to represent the instance of the output data itself
        self.terminal = sys.stdout # redirect all prints to a text file
        self.log = open("logfile.txt", "a+") #create a text file to save all data output
    def write(self, message): #declare output variable properties
        self.terminal.write(message) #Class function to send output to terminal
        self.log.write(message) #class function to send output to log file
    def flush(self): #to clear data buffer between terminal and standard out
        #this flush method is needed for python 3 compatibility.
        #this handles the flush command by doing nothing.
        pass
sys.stdout = Logger()

def sensor_output2(x):
    """define function to iterate sensor outputs for each cluster
    """
    while x in range(1,33): #setting range for 32 clusters
        print("Cluster",x) #print Each output with Cluster tag
        sensor_output() #print output from random numbers generated for each cluster
        print("") # Printing blanks after each cycle
        x +=1 #iterate through the numbers from 1 to 32


def sensor_output():
    """defining function to produce float values between 0 and 1 for 16 sensors per cluster
    """
    Sensors = [] #Creating a list to hold the values
    for sensor_data in range(0,16): #setting range of values to 16 per cluster
        sensor_data = random.random() #genrating random value between 0 and 1
        Sensors.append(sensor_data) #adding the values to the Cluster list
    print(Sensors) #print the values generated

n = 1
for x in range(30): # to generate timestamped reports for 30 times
    print('Data Report',n) #tag each sensor data output with a number
    print(time.ctime())
    sensor_output2(1)
    print ("Sensor Data",n,"Succesfully saved to log",n)
    print("") # Printing blanks after each cycle
    print("") # Printing blanks after each cycle
    print("") # Printing blanks after each cycle
    time.sleep(5) #set time of cycle to 5seconds
    n = n + 1 #set to cycle through the number of clusters in order

#Problem 3 - create corrupt dataset to check for error readings from sensors with sample data
#This checks for string data and creates an error log for string data in the sensor output
def test_data(testdata):
    """Checks for corrupt data (sensor output "err"), and log issues to log file (errorlog.txt)
    """
    logfile = open("errorlog.txt","a+") #create error log file
    logfile.close()
    logging.basicConfig(filename="errorlog.txt",level=logging.DEBUG) #give conditions to file
    for a,b in testdata.items(): #loop to give properties to data output search
        if "err" in b: #check for error output in data
            for c in range(0,len(b)): #loop over data output
                if b[c] == "err": #explicit search for err string
                    logging.error("{}: Error from Sensor {} in Cluster {}. Check Sensor for faults!".format(str(time.ctime()),c+1,a))   #print output to indicate the sensor and cluster that has faulty output

    print ("Sensor Data Errors logged in errorlog.txt.") #Print notification of error log

corrupt_data = {1: [0.8987651440099589, 0.8796066205216058, 0.6243047384450816, 0.856474058416365, 0.2458699810589856, 0.21439957058064318, "err", 0.6202802697629513, 0.6420252723143133, 0.024080958415120368, 0.6264652872081424, 0.5202536356501352, 0.13874929565848604, 0.8656466915745543, 0.9677894588971107, 0.9413958346773822], 2: [0.6275809678771885, "err", 0.8821377817181855, 0.16018890633330052, 0.8753231391190763, 0.8016977502403385, 0.2498340942245989, 0.7016718806077435, 0.059460117471525686, 0.3086826602266636, 0.13303950315023438, 0.9575466948751425, 0.5000440001861616, 0.7840672335518826, "err", 0.12235377281110893], 3: [0.04557776564928062, 0.26220177662045663, 0.9049281820635379, 0.3190068098113026, 0.8661915429704566, 0.5193786006101877, 0.6321853778821787, 0.37709070636561426, 0.5797875518668203, 0.3039623367808474, 0.5722484815050203, 0.14580495854224906, 0.6747184877160406, 0.0006866373411634763, 0.5011049103320555, 0.07923477297568327], 4: [0.3091990190677888, 0.7914218349987988, 0.9406569799448143, 0.7875860626108636, 0.9359850046365661, 0.8481490511384124, 0.17367180341824906, 0.890080270962151, 0.3204098240471249, 0.2112145938293708, 0.3791097487564392, 0.5929892613777542, 0.03928357633370949, 0.8694293649812406, 0.6413346050806897, 0.3157999140423161], 5: [0.42237486282108794, 0.6945805295646916, 0.19001169265548812, 0.7849003034713129, 0.26268258745338247, 0.5837024238905157, 0.2871653345345291, 0.7640575520948718, 0.48315960692371807, 0.7670918046300976, 0.6738705257702046, 0.5579693030509559, 0.3319109596121502, 0.5041805884935235, 0.30604755077980783, 0.2249380495631219], 6: [0.7645877708781799, 0.6341154391402457, 0.40108082297780434, 0.785967374683848, 0.5351366367229781, 0.25308152988824406, 0.2868510643748806, 0.16804129479974717, 0.10870373410425915, 0.9119824581525982, 0.5570006084743893, 0.3155672606775891, 0.10425370844735515, 0.3281587539540133, 0.6277258994323459, 0.6380762865392825], 7: [0.5273737176331901, 0.05943529989327223, 0.4555544688888924, 0.5319805714753992, 0.6998318064523021, 0.532427514933047, 0.8312952124927598, 0.48564477584123555, 0.9839495074292038, 0.5710824570880223, 0.5204135947169747, 0.3049601187207365, 0.26755614839484343, 0.6944787296406963, 0.8881856109820998, 0.4881729989857855], 8: [0.5066618171707192, 0.5166212916726207, 0.7408465691868759, 0.5956342014835128, 0.04583444277687576, 0.304398080221457, 0.1211402225235424, 0.9863616180567361, 0.9503003874846354, 0.8083322768935337, 0.7833353912402954, 0.20535521229562825, 0.6386192437099389, 0.24378499469361814, 0.023880632367751287, 0.6419080569876556], 9: [0.1025028761375465, 0.8611699002999355, 0.7124910300518751, 0.46418006432281167, 0.5853817306349749, 0.7805453399721689, 0.7967878649570181, 0.012499490053442086, 0.13835755586091902, 0.2871560701322905, 0.8937611413780124, 0.9883795454614928, 0.06443278384313655, 0.0014047481678167717, 0.6409077999611273, 0.15065058107243], 10: [0.9602390785975105, 0.006942928567155726, 0.25060080734304, 0.02552116894513501, 0.7319013762495468, 0.624168188597154, 0.2608669843662733, 0.9906194724506311, 0.02967573991253858, 0.04820664292246912, 0.9001329764305889, 0.6646011128231076, 0.8389267289033197, 0.37709785479616187, 0.7151211288317396, 0.011408591277987656], 11: [0.14769465685793515, 0.6048881885591246, 0.5718034417140051, 0.023682112778946385, 0.7704994014041366, 0.7029647940255743, 0.5357070962870726, 0.1446472979094463, 0.3160608735144683, 0.430500824750672, 0.022644572485656322, 0.9412600660052177, 0.001679524075206551, 0.6321774626008256, 0.8496825203197844, 0.4270840654372383], 12: [0.8301719491481752, 0.07940164923500026, 0.20241294291606637, 0.33341719310048457, 0.3317785671195894, 0.6865307807389154, 0.656587238591613, 0.5847408991413985, 0.6508623423393028, 0.1988833213677632, 0.2820065869773407, 0.12209005130662054, 0.26018614294507125, 0.9617245423600624, 0.6630260690400509, 0.9210954911725707], 13: [0.42221373477168944, 0.09492860512694368, 0.9393322276684698, 0.8949851134651658, 0.2669178385362566, 0.3168665602145645, 0.3489667498341227, 0.8815266791627273, 0.5792485043731093, 0.4872914744393949, 0.028678309532535584, 0.3055107602836937, 0.7591802972241726, 0.029438381203375497, 0.8889588445898526, 0.6395550297120152], 14: [0.987482109608214, 0.969009897537427, 0.9548999163721066, 0.42965968326568027, 0.6163698426119949, 0.762428413202005, 0.5531637848259154, 0.859388969434768, 0.978087161816053, 0.8138060906400633, 0.20652664104186536, 0.5788747416480131, 0.0039029924035760555, 0.1660976261274446, 0.8822732123663822, 0.40497455779103686], 15: [0.7176094925573107, "err", 0.5780917296927838, 0.3341624760145513, 0.9106267517891453, 0.8946675950702403, 0.977802081712714, 0.9194342888592033, 0.7659808729141577, 0.5723031499949726, 0.5252042787737871, 0.2285657060873174, 0.6713616965616708, 0.3076258905969107, 0.10501087345215865, 0.6783528788213933], 16: [0.33869370599978255, 0.8417398843709164, 0.0627541144482825, 0.45293685736954914, 0.4577259034768789, 0.3380677773445957, 0.02483362488651708, 0.06283812306660608, 0.8020501291576839, 0.3460468511248793, 0.37705523632805826, 0.9256349308747492, 0.06998388921979692, 0.32567062094269716, 0.3159589726234059, 0.05709049726158666], 17: [0.08830665696957218, 0.3528305701434685, 0.6972314327071377, 0.942384470156663, 0.35808520123147847, 0.7854143534971134, "err", 0.970928308324136, 0.7818508383288761, 0.8662821870896108, 0.4297544190163841, 0.3012861637344333, 0.5490394774969074, 0.5999767887086541, 0.4461776652764128, 0.19306943003980892], 18: [0.5096563776740411, 0.3157514863699916, 0.8550704753711144, 0.944351696444653, 0.6667859306880731, 0.6374396557181665, 0.7661768688572438, 0.11198305679223686, 0.7092779254817932, 0.820397473005774, 0.31385211225152276, 0.6031397789848187, 0.07917816350986073, 0.33978264169072603, 0.6332118861536925, 0.8073465005370947], 19: [0.35916915505709146, 0.783537672274318, 0.38130497551197484, 0.4302306810964298, 0.10510405255984645, 0.8424036957353755, 0.7426509601317816, 0.6835939014071003, 0.5262452335893266, 0.1366454923512388, 0.8899648064853324, 0.02410208063303354, 0.3580369262027089, 0.5624946584430917, 0.2832275027886878, "err"], 20: [0.3319230444258313, 0.9553335551241604, 0.04293820881613264, 0.5706715221504278, 0.9540695420361763, 0.5259860933732576, 0.4613253735762798, 0.9986951217526263, 0.8444929430376711, 0.6136929910548959, 0.44408034624846826, 0.450600996652169, 0.5434788866942278, 0.6626785308828852, 0.714455163043205, 0.7878550050879876], 21: [0.6603641651754175, 0.42491822059986684, 0.181778578775609, 0.7058342330581068, 0.11558236296471802, 0.9229975120317557, 0.42945089104932577, 0.656069546854712, 0.4230116110440416, 0.42655626009042136, 0.37054453181522384, 0.19062416768024104, 0.8053933941709414, 0.5596598722957626, 0.021310890892564993, 0.004775709212900603], 22: [0.4638315013909544, 0.23167341384295126, 0.6966073772379954, 0.7281588585126414, 0.21213707207799615, 0.5892400693593549, 0.8244514504646027, 0.5454088152779041, 0.8541063320241503, 0.21626502000798287, 0.9796149446216692, 0.14889076476460572, 0.26601449231109175, 0.15312140322677825, 0.946956336588058, 0.023390674282825485], 23: [0.5617790011657906, 0.011136768387570273, 0.9190040282735709, 0.3440483417641299, 0.32620562102723205, 0.46677216801892296, 0.8410496545019791, 0.9088813291881336, 0.31229014163545876, 0.19644909435125713, 0.7973656791880634, 0.4019191005787962, 0.3967730526943746, 0.7144784092574475, 0.8866770049630601, 0.387266475015685], 24: [0.28528952930550266, 0.9289123511294094, 0.6982533085803482, 0.7935887977467184, 0.8339041902224783, 0.1084272880701781, 0.43384483982519273, 0.9835287338105538, 0.18451132239890322, 0.5020111758814494, 0.2566555305333734, 0.6932680051260112, 0.8403695354945979, 0.9385642201475565, 0.04721094917516, 0.7772769640679216], 25: [0.46998912110239655, 0.37137468142753594, 0.26642433956744394, 0.6274997106146247, 0.5311382580703142, 0.3158218200564994, 0.37276921817852715, 0.10873109252487434, 0.25014706757360194, 0.36358868473364947, 0.2252073329600337, 0.5417372201257824, 0.034010254920759264, 0.5099302836144196, 0.6890347518564965, 0.2863446499991198], 26: [0.5899708349623375, 0.13871971651164305, 0.25318528125722506, 0.9544520231430341, 0.5285586984650835, 0.6611898740245715, 0.6108346699614998, 0.6004954300196665, 0.46886096149910184, 0.5789728117455822, 0.9348577452754049, 0.2978443171712033, 0.10142994504764868, 0.3682274189464224, 0.801398417754599, 0.5875329571364475], 27: [0.44312608375501117, 0.6774707638491989, 0.8491538648733846, 0.42126251545932314, "err", 0.2228732223752864, 0.27401080100529474, 0.1834640735256482, 0.17354151830967057, 0.9641579016107351, 0.8696472578479622, 0.41618369922050913, 0.1077663961734231, 0.17227077641155641, 0.4550799897728295, 0.7081760078716535], 28: [0.6141429409942227, 0.07623910838442105, 0.33838098108853887, 0.7906517804008983, 0.9135178331462199, 0.10711715366938879, 0.5746355110507204, 0.5606034145472985, 0.1497959203473973, 0.8538849096474308, 0.420034307393103, 0.5512480096421173, 0.12991761147108172, 0.14085964686496244, 0.41290143849625993, 0.23927884229705554], 29: [0.795808909589838, 0.42658611343582065, 0.7455258826318043, 0.24276021655185887, 0.13327654693795998, 0.7672504437085296, 0.08111478499474412, 0.3979646049905431, 0.9017772390693883, 0.5942015354542418, 0.0356281772841448, 0.569687339229581, 0.05464795599626182, 0.5789829743575698, 0.46126924333861563, 0.5387735734545266], 30: [0.9449924978934512, 0.549945056543698, 0.4665487272999984, 0.8706135903573278, 0.053885378315598254, 0.42608671059972136, 0.5970769415147752, 0.19840091500265444, 0.5553137749424372, 0.5058580917603119, 0.8348379956669992, 0.3871570580972935, 0.7847726361388814, 0.7265101852449867, 0.4505892681375583, 0.9781657811323983], 31: [0.0777710014455415, 0.056126278418018205, 0.8184773586891116, 0.6186213107442632, 0.28754669293837476, 0.8281657486832585, 0.48794931739605063, 0.8176825802249993, 0.013401485242631073, 0.4767137086964909, 0.34400409433978296, 0.5194357098201697, 0.7675293872077746, 0.43500298034043205, 0.9635401410847877, 0.7307097858078815], 32: [0.7239307021197589, 0.4367555924089105, 0.19812499032568254, 0.15612360218576293, 0.7283482379030457, 0.8304199922814371, 0.5080193950125003, 0.6483645655590436, 0.44829057513891446, 0.6577412585552, 0.4127820958842269, 0.9884068304944741, 0.4409720881477086, 0.751521730507094, 0.4281772936981627, 0.0721806950820636]}

test_data(corrupt_data)# Test for currupt data (sensor output "err")

